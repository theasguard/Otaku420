import json
import requests
import urllib.parse

    def _get_episode_sources_pack(self, show, anilist_id, episode):
        query = '%s "Batch"|"Complete Series"' % show
    
        episodes = pickle.loads(database.get_show(anilist_id)['kodi_meta'])['episodes']
        if episodes:
            query += '|"01-{0}"|"01~{0}"|"01 - {0}"|"01 ~ {0}"'.format(episodes)
    
        season = database.get_season_list(anilist_id)
        if season:
            season = season['season']
            query += '|"S{0}"|"Season {0}"'.format(season)
    
        # New code to get synonyms from Find My Anime API
        try:
            # URL for Find My Anime API
            api_url = "https://find-my-anime.dtimur.de/api?id={}&provider=Anilist".format(anilist_id)
    
            # Make the API request
            response = requests.get(api_url)
            response.raise_for_status()  # Raise an exception for HTTP errors
    
            # Parse the JSON response
            data = response.json()
    
            # Get the synonyms using list comprehension
            synonyms = [synonym for synonym in data[0].get('synonyms', [])]
    
            # Add synonyms to the query
            for synonym in synonyms:
                query += '|("{}")'.format(synonym)
    
        except requests.exceptions.RequestException as e:
            # Handle request exceptions
            print("Error:", e)
        except (IndexError, KeyError):
            # Handle invalid response or missing data
            print("Invalid response from the API")
    
        url = '%s?f=0&c=1_2&q=%s&s=seeders&&o=desc' % (self._BASE_URL, urllib.parse.quote_plus(query))
        return self._process_nyaa_backup(url, anilist_id, 2, episode.zfill(2), True)
